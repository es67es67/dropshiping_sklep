# REGUÅY TESTÃ“W PUPPETEER - STANDARDY I NAJLEPSZE PRAKTYKI

## ğŸ¯ CEL GÅÃ“WNY

Cursor AI automatycznie uruchamia i monitoruje testy Puppeteer jako kluczowy element workflow, zapewniajÄ…c wysokÄ… jakoÅ›Ä‡ UX i funkcjonalnoÅ›ci portalu spoÅ‚ecznoÅ›ciowo-handlowego.

## ğŸ›¡ï¸ PRIORYTET 1: AUTOMATYCZNE TESTY PUPPETEER

### Przed kaÅ¼dÄ… zmianÄ… kodu:
1. **Automatyczne uruchomienie testÃ³w Puppeteer** - sprawdzenie wszystkich Å›cieÅ¼ek uÅ¼ytkownika
2. **Analiza screenshotÃ³w** - porÃ³wnanie z baseline'ami
3. **Walidacja funkcjonalnoÅ›ci** - sprawdzenie wszystkich kluczowych funkcji
4. **Performance monitoring** - pomiar czasu Å‚adowania i responsywnoÅ›ci

### Po kaÅ¼dej zmianie:
```bash
# Automatyczny workflow testÃ³w Puppeteer
npm run test:puppeteer:smoke        # Podstawowe testy funkcjonalnoÅ›ci
npm run test:puppeteer:friendship   # Testy systemu znajomoÅ›ci
npm run test:puppeteer:notifications # Testy powiadomieÅ„
npm run test:puppeteer:ecommerce    # Testy e-commerce
npm run test:puppeteer:responsive   # Testy responsywnoÅ›ci
npm run test:puppeteer:performance  # Testy wydajnoÅ›ci
npm run test:puppeteer:accessibility # Testy dostÄ™pnoÅ›ci
```

## ğŸ“‹ STANDARDY TESTÃ“W PUPPETEER

### Struktura testÃ³w:
```javascript
/**
 * @file test-[feature]-puppeteer.js
 * @description Testy Puppeteer dla funkcji [feature]
 * @author Cursor AI
 * @version 1.0.0
 * @dependencies puppeteer, fs, path
 * @testedFeatures [lista testowanych funkcji]
 * @screenshots [lista generowanych screenshotÃ³w]
 */

const puppeteer = require('puppeteer');
const path = require('path');
const fs = require('fs');

// Konfiguracja
const BASE_URL = 'http://localhost:3000';
const API_URL = 'http://localhost:5000/api';
const SCREENSHOT_DIR = path.join(__dirname, 'test-screenshots');

// Upewnij siÄ™, Å¼e katalog istnieje
if (!fs.existsSync(SCREENSHOT_DIR)) {
  fs.mkdirSync(SCREENSHOT_DIR, { recursive: true });
}

// Funkcja do robienia screenshotÃ³w z timestamp
const takeScreenshot = async (page, name) => {
  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
  const filename = `${name}_${timestamp}.png`;
  const filepath = path.join(SCREENSHOT_DIR, filename);
  await page.screenshot({ 
    path: filepath, 
    fullPage: true,
    quality: 90
  });
  console.log(`ğŸ“¸ Screenshot: ${filename}`);
  return filepath;
};

// Funkcja do logowania z timestamp
const log = (message) => {
  const timestamp = new Date().toISOString();
  console.log(`[${timestamp}] ${message}`);
};

// Funkcja do czekania na element z timeout
const waitForElement = async (page, selector, timeout = 10000) => {
  try {
    await page.waitForSelector(selector, { timeout });
    return true;
  } catch (error) {
    console.log(`âŒ Element nie znaleziony: ${selector}`);
    return false;
  }
};
```

### Standardy funkcji testowych:
```javascript
// Funkcja do logowania uÅ¼ytkownika
const loginUser = async (page, email, password) => {
  try {
    log(`ğŸ” Logowanie uÅ¼ytkownika: ${email}`);
    
    // PrzejdÅº do strony logowania
    await page.goto(`${BASE_URL}/login`);
    await takeScreenshot(page, '01_login_page');
    
    // WypeÅ‚nij formularz
    await waitForElement(page, 'input[name="emailOrUsername"], input[name="email"], input[type="email"]');
    await page.type('input[name="emailOrUsername"], input[name="email"], input[type="email"]', email);
    await page.type('input[name="password"], input[type="password"]', password);
    
    // Kliknij przycisk logowania
    await page.click('button[type="submit"], input[type="submit"]');
    
    // Czekaj na przekierowanie
    await page.waitForNavigation({ waitUntil: 'networkidle0', timeout: 10000 });
    
    // SprawdÅº czy logowanie siÄ™ udaÅ‚o
    const currentUrl = page.url();
    if (currentUrl.includes('/login')) {
      log(`âŒ Logowanie nieudane - nadal na stronie logowania`);
      await takeScreenshot(page, '02_login_failed');
      return false;
    }
    
    log(`âœ… Logowanie udane - przekierowano do: ${currentUrl}`);
    await takeScreenshot(page, '03_after_login');
    return true;
    
  } catch (error) {
    log(`âŒ BÅ‚Ä…d podczas logowania: ${error.message}`);
    await takeScreenshot(page, 'ERROR_login');
    return false;
  }
};
```

## ğŸ”„ AUTOMATYCZNY WORKFLOW TESTÃ“W

### Po kaÅ¼dej zmianie kodu:
1. **Automatyczne uruchomienie testÃ³w Puppeteer**
2. **Analiza wynikÃ³w i screenshotÃ³w**
3. **PorÃ³wnanie z baseline'ami**
4. **Automatyczna naprawa jeÅ›li testy nie przechodzÄ…**
5. **Ponowne uruchomienie testÃ³w**
6. **Raportowanie wynikÃ³w**

### JeÅ›li test nie przejdzie:
```javascript
// Automatyczna analiza bÅ‚Ä™dÃ³w
const analyzeTestFailure = async (error, screenshotPath) => {
  log(`ğŸ” AnalizujÄ™ bÅ‚Ä…d testu: ${error.message}`);
  
  // Analiza screenshotu
  if (screenshotPath) {
    log(`ğŸ“¸ AnalizujÄ™ screenshot: ${screenshotPath}`);
    // Automatyczna analiza wizualna
  }
  
  // Analiza logÃ³w konsoli
  const consoleLogs = await page.evaluate(() => {
    return window.console.logs || [];
  });
  
  // Analiza bÅ‚Ä™dÃ³w JavaScript
  const jsErrors = await page.evaluate(() => {
    return window.jsErrors || [];
  });
  
  // Propozycja naprawy
  log(`ğŸ”§ ProponujÄ™ naprawÄ™: ${generateFixProposal(error, consoleLogs, jsErrors)}`);
};
```

## ğŸ“Š STANDARDY RAPORTOWANIA

### Automatyczne raporty testÃ³w:
```javascript
// Raport testÃ³w Puppeteer
const generateTestReport = async (testResults) => {
  const report = {
    timestamp: new Date().toISOString(),
    totalTests: testResults.length,
    passed: testResults.filter(r => r.status === 'passed').length,
    failed: testResults.filter(r => r.status === 'failed').length,
    screenshots: testResults.map(r => r.screenshot),
    performance: {
      averageLoadTime: calculateAverageLoadTime(testResults),
      slowestPage: findSlowestPage(testResults),
      fastestPage: findFastestPage(testResults)
    },
    accessibility: {
      violations: testResults.flatMap(r => r.accessibilityViolations || []),
      score: calculateAccessibilityScore(testResults)
    },
    responsive: {
      mobile: testResults.filter(r => r.device === 'mobile').length,
      tablet: testResults.filter(r => r.device === 'tablet').length,
      desktop: testResults.filter(r => r.device === 'desktop').length
    }
  };
  
  // Zapisz raport
  const reportPath = path.join(SCREENSHOT_DIR, `test-report-${Date.now()}.json`);
  fs.writeFileSync(reportPath, JSON.stringify(report, null, 2));
  
  return report;
};
```

## ğŸ¨ STANDARDY SCREENSHOTÃ“W

### Konwencja nazewnictwa:
```javascript
// Format: [numer]_[nazwa]_[timestamp].png
// PrzykÅ‚ady:
// 01_main_page_2025-07-24T08-16-23-112Z.png
// 02_login_form_2025-07-24T08-16-25-234Z.png
// 03_after_login_2025-07-24T08-16-27-456Z.png
// ERROR_login_2025-07-24T08-16-29-789Z.png

const takeScreenshot = async (page, name) => {
  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
  const filename = `${name}_${timestamp}.png`;
  const filepath = path.join(SCREENSHOT_DIR, filename);
  
  // Konfiguracja screenshotu
  await page.screenshot({ 
    path: filepath, 
    fullPage: true,
    quality: 90,
    type: 'png'
  });
  
  console.log(`ğŸ“¸ Screenshot: ${filename}`);
  return filepath;
};
```

### Automatyczna analiza screenshotÃ³w:
```javascript
// PorÃ³wnanie z baseline'ami
const compareWithBaseline = async (currentScreenshot, baselinePath) => {
  if (!fs.existsSync(baselinePath)) {
    log(`âš ï¸ Brak baseline dla: ${baselinePath}`);
    return { status: 'no_baseline', diff: null };
  }
  
  // PorÃ³wnanie wizualne
  const diff = await compareImages(currentScreenshot, baselinePath);
  
  if (diff.percentage > 5) {
    log(`âŒ Znaleziono rÃ³Å¼nice wizualne: ${diff.percentage}%`);
    return { status: 'failed', diff: diff.percentage };
  }
  
  log(`âœ… Screenshot zgodny z baseline`);
  return { status: 'passed', diff: diff.percentage };
};
```

## ğŸš€ STANDARDY WYDAJNOÅšCI

### Monitoring wydajnoÅ›ci:
```javascript
// Pomiar czasu Å‚adowania
const measurePageLoadTime = async (page, url) => {
  const startTime = Date.now();
  
  await page.goto(url, { 
    waitUntil: 'networkidle0',
    timeout: 30000 
  });
  
  const loadTime = Date.now() - startTime;
  
  // Pomiar metryk wydajnoÅ›ci
  const performanceMetrics = await page.evaluate(() => {
    const navigation = performance.getEntriesByType('navigation')[0];
    return {
      domContentLoaded: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,
      loadComplete: navigation.loadEventEnd - navigation.loadEventStart,
      firstContentfulPaint: performance.getEntriesByName('first-contentful-paint')[0]?.startTime,
      largestContentfulPaint: performance.getEntriesByName('largest-contentful-paint')[0]?.startTime
    };
  });
  
  return {
    totalLoadTime: loadTime,
    ...performanceMetrics
  };
};
```

## â™¿ STANDARDY DOSTÄ˜PNOÅšCI

### Testy dostÄ™pnoÅ›ci:
```javascript
// Sprawdzenie dostÄ™pnoÅ›ci
const checkAccessibility = async (page) => {
  const violations = await page.evaluate(() => {
    // SprawdÅº kontrast kolorÃ³w
    const contrastIssues = [];
    const elements = document.querySelectorAll('*');
    
    elements.forEach(el => {
      const style = window.getComputedStyle(el);
      const backgroundColor = style.backgroundColor;
      const color = style.color;
      
      // SprawdÅº kontrast (uproszczona wersja)
      if (color && backgroundColor) {
        // Implementacja sprawdzania kontrastu
      }
    });
    
    // SprawdÅº alt teksty
    const imagesWithoutAlt = Array.from(document.querySelectorAll('img')).filter(img => !img.alt);
    
    // SprawdÅº nagÅ‚Ã³wki
    const headingStructure = Array.from(document.querySelectorAll('h1, h2, h3, h4, h5, h6'))
      .map(h => ({ level: parseInt(h.tagName[1]), text: h.textContent }));
    
    return {
      contrastIssues,
      imagesWithoutAlt,
      headingStructure
    };
  });
  
  return violations;
};
```

## ğŸ“± STANDARDY RESPONSYWNOÅšCI

### Testy na rÃ³Å¼nych urzÄ…dzeniach:
```javascript
// Konfiguracja urzÄ…dzeÅ„
const devices = {
  mobile: { width: 375, height: 667, userAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15' },
  tablet: { width: 768, height: 1024, userAgent: 'Mozilla/5.0 (iPad; CPU OS 14_0 like Mac OS X) AppleWebKit/605.1.15' },
  desktop: { width: 1920, height: 1080, userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36' }
};

// Test responsywnoÅ›ci
const testResponsiveness = async (page, device) => {
  const { width, height, userAgent } = devices[device];
  
  await page.setViewport({ width, height });
  await page.setUserAgent(userAgent);
  
  log(`ğŸ“± TestujÄ™ na urzÄ…dzeniu: ${device} (${width}x${height})`);
  
  // PrzejdÅº przez gÅ‚Ã³wne strony
  const pages = ['/', '/login', '/register', '/shops', '/products'];
  
  for (const pageUrl of pages) {
    await page.goto(`${BASE_URL}${pageUrl}`);
    await takeScreenshot(page, `${device}_${pageUrl.replace('/', '')}`);
    
    // SprawdÅº czy strona jest responsywna
    const isResponsive = await page.evaluate(() => {
      return window.innerWidth <= 768 ? 
        document.querySelector('.mobile-menu, .hamburger') !== null :
        document.querySelector('.desktop-menu') !== null;
    });
    
    if (!isResponsive) {
      log(`âš ï¸ Problemy z responsywnoÅ›ciÄ… na ${device}: ${pageUrl}`);
    }
  }
};
```

## ğŸ”§ AUTOMATYCZNE NAPRAWY

### JeÅ›li test nie przejdzie:
```javascript
// Automatyczna naprawa problemÃ³w
const autoFixTestIssues = async (error, page) => {
  log(`ğŸ”§ PrÃ³bujÄ™ automatycznÄ… naprawÄ™: ${error.message}`);
  
  // Naprawa problemÃ³w z logowaniem
  if (error.message.includes('login')) {
    // SprawdÅº czy serwer dziaÅ‚a
    const serverStatus = await checkServerStatus();
    if (!serverStatus) {
      log(`ğŸš€ Uruchamiam serwer...`);
      await startServer();
    }
  }
  
  // Naprawa problemÃ³w z elementami
  if (error.message.includes('selector')) {
    // SprÃ³buj alternatywne selektory
    const alternativeSelectors = generateAlternativeSelectors(error.selector);
    for (const selector of alternativeSelectors) {
      try {
        await page.waitForSelector(selector, { timeout: 5000 });
        log(`âœ… Znaleziono alternatywny selector: ${selector}`);
        break;
      } catch (e) {
        continue;
      }
    }
  }
  
  // Naprawa problemÃ³w z timeout
  if (error.message.includes('timeout')) {
    log(`â° ZwiÄ™kszam timeout...`);
    await page.setDefaultTimeout(30000);
  }
};
```

## ğŸ“ˆ MONITORING I RAPORTOWANIE

### Automatyczne raporty:
```javascript
// Codzienny raport testÃ³w
const generateDailyReport = async () => {
  const today = new Date().toISOString().split('T')[0];
  const testFiles = fs.readdirSync(SCREENSHOT_DIR)
    .filter(file => file.includes(today))
    .filter(file => file.endsWith('.json'));
  
  const reports = testFiles.map(file => {
    const content = fs.readFileSync(path.join(SCREENSHOT_DIR, file), 'utf8');
    return JSON.parse(content);
  });
  
  const summary = {
    date: today,
    totalTests: reports.reduce((sum, r) => sum + r.totalTests, 0),
    passed: reports.reduce((sum, r) => sum + r.passed, 0),
    failed: reports.reduce((sum, r) => sum + r.failed, 0),
    successRate: 0,
    averageLoadTime: 0,
    criticalIssues: []
  };
  
  summary.successRate = (summary.passed / summary.totalTests) * 100;
  summary.averageLoadTime = reports.reduce((sum, r) => sum + (r.performance?.averageLoadTime || 0), 0) / reports.length;
  
  // Zapisz raport dzienny
  const dailyReportPath = path.join(SCREENSHOT_DIR, `daily-report-${today}.json`);
  fs.writeFileSync(dailyReportPath, JSON.stringify(summary, null, 2));
  
  return summary;
};
```

## ğŸ¯ PODSUMOWANIE

Cursor AI automatycznie:
1. **Uruchamia testy Puppeteer** po kaÅ¼dej zmianie kodu
2. **Analizuje screenshoty** i porÃ³wnuje z baseline'ami
3. **Monitoruje wydajnoÅ›Ä‡** i dostÄ™pnoÅ›Ä‡
4. **Testuje responsywnoÅ›Ä‡** na rÃ³Å¼nych urzÄ…dzeniach
5. **Generuje raporty** z wynikami testÃ³w
6. **Naprawia problemy** automatycznie gdy to moÅ¼liwe
7. **Dokumentuje zmiany** w changelogu

**Cel**: Zapewnienie najwyÅ¼szej jakoÅ›ci UX i funkcjonalnoÅ›ci portalu poprzez automatyczne testy przeglÄ…darkowe.
description: ReguÅ‚y dla automatycznych testÃ³w Puppeteer z kompleksowymi standardami i najlepszymi praktykami
globs: ["**/*.js", "**/*.jsx", "**/*.ts", "**/*.tsx"]
alwaysApply: true
---
description:
globs:
alwaysApply: false
---
